2019-08-18 15:48:53.957 +08:00 [INF] Starting IdentityServer4 version 2.3.2.0
2019-08-18 15:48:54.469 +08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2019-08-18 15:48:54.470 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2019-08-18 15:48:54.471 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2019-08-18 15:48:54.471 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2019-08-18 15:48:54.472 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2019-08-18 15:48:54.472 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2019-08-18 15:48:54.637 +08:00 [FTL] Unable to start Kestrel.
System.IO.IOException: Failed to bind to address http://127.0.0.1:5000: address already in use. ---> Microsoft.AspNetCore.Connections.AddressInUseException: 通常每个套接字地址(协议/网络地址/端口)只允许使用一次。 ---> System.Net.Sockets.SocketException: 通常每个套接字地址(协议/网络地址/端口)只允许使用一次。
   at System.Net.Sockets.Socket.UpdateStatusAfterSocketErrorAndThrowException(SocketError error, String callerName)
   at System.Net.Sockets.Socket.DoBind(EndPoint endPointSnapshot, SocketAddress socketAddress)
   at System.Net.Sockets.Socket.Bind(EndPoint localEP)
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketTransport.BindAsync()
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketTransport.BindAsync()
   at Microsoft.AspNetCore.Server.Kestrel.Core.KestrelServer.<>c__DisplayClass22_0`1.<<StartAsync>g__OnBind|0>d.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.BindEndpointAsync(ListenOptions endpoint, AddressBindContext context)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.BindEndpointAsync(ListenOptions endpoint, AddressBindContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.LocalhostListenOptions.BindAsync(AddressBindContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.AddressesStrategy.BindAsync(AddressBindContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.BindAsync(IServerAddressesFeature addresses, KestrelServerOptions serverOptions, ILogger logger, Func`2 createBinding)
   at Microsoft.AspNetCore.Server.Kestrel.Core.KestrelServer.StartAsync[TContext](IHttpApplication`1 application, CancellationToken cancellationToken)
2019-08-18 15:48:54.685 +08:00 [FTL] An error occurred stopping the application
System.AggregateException: One or more errors occurred. (Not started. Call Start first.) ---> System.InvalidOperationException: Not started. Call Start first.
   at IdentityServer4.EntityFramework.TokenCleanup.Stop() in C:\local\identity\server4\EntityFramework.Storage\src\TokenCleanup\TokenCleanup.cs:line 77
   at Microsoft.Extensions.DependencyInjection.TokenCleanupHost.StopAsync(CancellationToken cancellationToken) in C:\local\identity\server4\EntityFramework\src\TokenCleanupHost.cs:line 37
   at Microsoft.AspNetCore.Hosting.Internal.HostedServiceExecutor.<>c__DisplayClass4_0.<StopAsync>b__0(IHostedService service)
   at Microsoft.AspNetCore.Hosting.Internal.HostedServiceExecutor.ExecuteAsync(Func`2 callback)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Hosting.Internal.HostedServiceExecutor.ExecuteAsync(Func`2 callback)
   at Microsoft.AspNetCore.Hosting.Internal.HostedServiceExecutor.StopAsync(CancellationToken token)
---> (Inner Exception #0) System.InvalidOperationException: Not started. Call Start first.
   at IdentityServer4.EntityFramework.TokenCleanup.Stop() in C:\local\identity\server4\EntityFramework.Storage\src\TokenCleanup\TokenCleanup.cs:line 77
   at Microsoft.Extensions.DependencyInjection.TokenCleanupHost.StopAsync(CancellationToken cancellationToken) in C:\local\identity\server4\EntityFramework\src\TokenCleanupHost.cs:line 37
   at Microsoft.AspNetCore.Hosting.Internal.HostedServiceExecutor.<>c__DisplayClass4_0.<StopAsync>b__0(IHostedService service)
   at Microsoft.AspNetCore.Hosting.Internal.HostedServiceExecutor.ExecuteAsync(Func`2 callback)<---

2019-08-18 15:51:25.216 +08:00 [INF] Starting IdentityServer4 version 2.3.2.0
2019-08-18 15:51:25.399 +08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2019-08-18 15:51:25.400 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2019-08-18 15:51:25.400 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2019-08-18 15:51:25.400 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2019-08-18 15:51:25.400 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2019-08-18 15:51:25.401 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2019-08-18 15:51:25.509 +08:00 [DBG] Starting grant removal
2019-08-18 15:53:15.505 +08:00 [DBG] Login Url: /Account/Login
2019-08-18 15:53:15.513 +08:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-08-18 15:53:15.514 +08:00 [DBG] Logout Url: /Account/Logout
2019-08-18 15:53:15.516 +08:00 [DBG] ConsentUrl Url: /consent
2019-08-18 15:53:15.516 +08:00 [DBG] Consent Return Url Parameter: returnUrl
2019-08-18 15:53:15.517 +08:00 [DBG] Error Url: /home/error
2019-08-18 15:53:15.518 +08:00 [DBG] Error Id Parameter: errorId
2019-08-18 15:53:15.546 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-18 15:53:15.563 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-18 15:53:15.564 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-18 15:53:15.571 +08:00 [DBG] Start discovery request
2019-08-18 15:53:27.531 +08:00 [ERR] An error occurred using the connection to database 'IdentityServer4.Combined-2.3.0' on server '(LocalDb)\MSSQLLocalDB'.
System.Data.SqlClient.SqlException (0x80131904): Cannot open database "IdentityServer4.Combined-2.3.0" requested by the login. The login failed.
Login failed for user 'MYZFC\zfc'.
   at System.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, SqlCredential credential, Object providerInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString userConnectionOptions, SessionData reconnectSessionData, Boolean applyTransientFaultHandling)
   at System.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, DbConnectionPoolKey poolKey, Object poolGroupProviderInfo, DbConnectionPool pool, DbConnection owningConnection, DbConnectionOptions userOptions)
   at System.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(DbConnectionPool pool, DbConnection owningObject, DbConnectionOptions options, DbConnectionPoolKey poolKey, DbConnectionOptions userOptions)
   at System.Data.ProviderBase.DbConnectionPool.CreateObject(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at System.Data.ProviderBase.DbConnectionPool.UserCreateRequest(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at System.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, UInt32 waitForMultipleObjectsTimeout, Boolean allowCreate, Boolean onlyOneCheckConnection, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at System.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at System.Data.ProviderBase.DbConnectionFactory.TryGetConnection(DbConnection owningConnection, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal oldConnection, DbConnectionInternal& connection)
   at System.Data.ProviderBase.DbConnectionInternal.TryOpenConnectionInternal(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at System.Data.ProviderBase.DbConnectionClosed.TryOpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at System.Data.SqlClient.SqlConnection.TryOpen(TaskCompletionSource`1 retry)
   at System.Data.SqlClient.SqlConnection.Open()
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenDbConnection(Boolean errorsExpected)
ClientConnectionId:c21b40b0-6daa-4d05-9282-cf817ba14645
Error Number:4060,State:1,Class:11
2019-08-18 15:53:27.588 +08:00 [ERR] An exception occurred in the database while iterating the results of a query for context type 'IdentityServer4.EntityFramework.DbContexts.ConfigurationDbContext'.
System.Data.SqlClient.SqlException (0x80131904): Cannot open database "IdentityServer4.Combined-2.3.0" requested by the login. The login failed.
Login failed for user 'MYZFC\zfc'.
   at System.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, SqlCredential credential, Object providerInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString userConnectionOptions, SessionData reconnectSessionData, Boolean applyTransientFaultHandling)
   at System.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, DbConnectionPoolKey poolKey, Object poolGroupProviderInfo, DbConnectionPool pool, DbConnection owningConnection, DbConnectionOptions userOptions)
   at System.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(DbConnectionPool pool, DbConnection owningObject, DbConnectionOptions options, DbConnectionPoolKey poolKey, DbConnectionOptions userOptions)
   at System.Data.ProviderBase.DbConnectionPool.CreateObject(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at System.Data.ProviderBase.DbConnectionPool.UserCreateRequest(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at System.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, UInt32 waitForMultipleObjectsTimeout, Boolean allowCreate, Boolean onlyOneCheckConnection, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at System.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at System.Data.ProviderBase.DbConnectionFactory.TryGetConnection(DbConnection owningConnection, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal oldConnection, DbConnectionInternal& connection)
   at System.Data.ProviderBase.DbConnectionInternal.TryOpenConnectionInternal(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at System.Data.ProviderBase.DbConnectionClosed.TryOpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at System.Data.SqlClient.SqlConnection.TryOpen(TaskCompletionSource`1 retry)
   at System.Data.SqlClient.SqlConnection.Open()
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenDbConnection(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.Open(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryingEnumerable`1.Enumerator.BufferlessMoveNext(DbContext _, Boolean buffer)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryingEnumerable`1.Enumerator.MoveNext()
   at System.Linq.Enumerable.SelectEnumerableIterator`2.MoveNext()
   at Microsoft.EntityFrameworkCore.Query.Internal.LinqOperatorProvider._TrackEntities[TOut,TIn](IEnumerable`1 results, QueryContext queryContext, IList`1 entityTrackingInfos, IList`1 entityAccessors)+MoveNext()
   at Microsoft.EntityFrameworkCore.Query.Internal.LinqOperatorProvider.ExceptionInterceptor`1.EnumeratorExceptionInterceptor.MoveNext()
ClientConnectionId:c21b40b0-6daa-4d05-9282-cf817ba14645
Error Number:4060,State:1,Class:11
System.Data.SqlClient.SqlException (0x80131904): Cannot open database "IdentityServer4.Combined-2.3.0" requested by the login. The login failed.
Login failed for user 'MYZFC\zfc'.
   at System.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, SqlCredential credential, Object providerInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString userConnectionOptions, SessionData reconnectSessionData, Boolean applyTransientFaultHandling)
   at System.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, DbConnectionPoolKey poolKey, Object poolGroupProviderInfo, DbConnectionPool pool, DbConnection owningConnection, DbConnectionOptions userOptions)
   at System.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(DbConnectionPool pool, DbConnection owningObject, DbConnectionOptions options, DbConnectionPoolKey poolKey, DbConnectionOptions userOptions)
   at System.Data.ProviderBase.DbConnectionPool.CreateObject(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at System.Data.ProviderBase.DbConnectionPool.UserCreateRequest(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at System.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, UInt32 waitForMultipleObjectsTimeout, Boolean allowCreate, Boolean onlyOneCheckConnection, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at System.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at System.Data.ProviderBase.DbConnectionFactory.TryGetConnection(DbConnection owningConnection, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal oldConnection, DbConnectionInternal& connection)
   at System.Data.ProviderBase.DbConnectionInternal.TryOpenConnectionInternal(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at System.Data.ProviderBase.DbConnectionClosed.TryOpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at System.Data.SqlClient.SqlConnection.TryOpen(TaskCompletionSource`1 retry)
   at System.Data.SqlClient.SqlConnection.Open()
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenDbConnection(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.Open(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryingEnumerable`1.Enumerator.BufferlessMoveNext(DbContext _, Boolean buffer)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryingEnumerable`1.Enumerator.MoveNext()
   at System.Linq.Enumerable.SelectEnumerableIterator`2.MoveNext()
   at Microsoft.EntityFrameworkCore.Query.Internal.LinqOperatorProvider._TrackEntities[TOut,TIn](IEnumerable`1 results, QueryContext queryContext, IList`1 entityTrackingInfos, IList`1 entityAccessors)+MoveNext()
   at Microsoft.EntityFrameworkCore.Query.Internal.LinqOperatorProvider.ExceptionInterceptor`1.EnumeratorExceptionInterceptor.MoveNext()
ClientConnectionId:c21b40b0-6daa-4d05-9282-cf817ba14645
Error Number:4060,State:1,Class:11
2019-08-18 15:53:27.670 +08:00 [INF] {"Details":"System.Data.SqlClient.SqlException (0x80131904): Cannot open database \"IdentityServer4.Combined-2.3.0\" requested by the login. The login failed.\r\nLogin failed for user 'MYZFC\\zfc'.\r\n   at System.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, SqlCredential credential, Object providerInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString userConnectionOptions, SessionData reconnectSessionData, Boolean applyTransientFaultHandling)\r\n   at System.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, DbConnectionPoolKey poolKey, Object poolGroupProviderInfo, DbConnectionPool pool, DbConnection owningConnection, DbConnectionOptions userOptions)\r\n   at System.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(DbConnectionPool pool, DbConnection owningObject, DbConnectionOptions options, DbConnectionPoolKey poolKey, DbConnectionOptions userOptions)\r\n   at System.Data.ProviderBase.DbConnectionPool.CreateObject(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)\r\n   at System.Data.ProviderBase.DbConnectionPool.UserCreateRequest(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)\r\n   at System.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, UInt32 waitForMultipleObjectsTimeout, Boolean allowCreate, Boolean onlyOneCheckConnection, DbConnectionOptions userOptions, DbConnectionInternal& connection)\r\n   at System.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal& connection)\r\n   at System.Data.ProviderBase.DbConnectionFactory.TryGetConnection(DbConnection owningConnection, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal oldConnection, DbConnectionInternal& connection)\r\n   at System.Data.ProviderBase.DbConnectionInternal.TryOpenConnectionInternal(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)\r\n   at System.Data.ProviderBase.DbConnectionClosed.TryOpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)\r\n   at System.Data.SqlClient.SqlConnection.TryOpen(TaskCompletionSource`1 retry)\r\n   at System.Data.SqlClient.SqlConnection.Open()\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenDbConnection(Boolean errorsExpected)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.Open(Boolean errorsExpected)\r\n   at Microsoft.EntityFrameworkCore.Query.Internal.QueryingEnumerable`1.Enumerator.BufferlessMoveNext(DbContext _, Boolean buffer)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)\r\n   at Microsoft.EntityFrameworkCore.Query.Internal.QueryingEnumerable`1.Enumerator.MoveNext()\r\n   at System.Linq.Enumerable.SelectEnumerableIterator`2.MoveNext()\r\n   at Microsoft.EntityFrameworkCore.Query.Internal.LinqOperatorProvider._TrackEntities[TOut,TIn](IEnumerable`1 results, QueryContext queryContext, IList`1 entityTrackingInfos, IList`1 entityAccessors)+MoveNext()\r\n   at Microsoft.EntityFrameworkCore.Query.Internal.LinqOperatorProvider.ExceptionInterceptor`1.EnumeratorExceptionInterceptor.MoveNext()\r\n   at System.Collections.Generic.LargeArrayBuilder`1.AddRange(IEnumerable`1 items)\r\n   at System.Collections.Generic.EnumerableHelpers.ToArray[T](IEnumerable`1 source)\r\n   at System.Linq.Enumerable.ToArray[TSource](IEnumerable`1 source)\r\n   at IdentityServer4.EntityFramework.Stores.ResourceStore.GetAllResourcesAsync() in C:\\local\\identity\\server4\\EntityFramework.Storage\\src\\Stores\\ResourceStore.cs:line 138\r\n   at IdentityServer4.Stores.IResourceStoreExtensions.GetAllEnabledResourcesAsync(IResourceStore store) in C:\\local\\identity\\server4\\IdentityServer4\\src\\Extensions\\IResourceStoreExtensions.cs:line 105\r\n   at IdentityServer4.ResponseHandling.DiscoveryResponseGenerator.CreateDiscoveryDocumentAsync(String baseUrl, String issuerUri) in C:\\local\\identity\\server4\\IdentityServer4\\src\\ResponseHandling\\Default\\DiscoveryResponseGenerator.cs:line 169\r\n   at IdentityServer4.Endpoints.DiscoveryEndpoint.ProcessAsync(HttpContext context) in C:\\local\\identity\\server4\\IdentityServer4\\src\\Endpoints\\DiscoveryEndpoint.cs:line 58\r\n   at IdentityServer4.Hosting.IdentityServerMiddleware.Invoke(HttpContext context, IEndpointRouter router, IUserSession session, IEventService events) in C:\\local\\identity\\server4\\IdentityServer4\\src\\Hosting\\IdentityServerMiddleware.cs:line 54\r\nClientConnectionId:c21b40b0-6daa-4d05-9282-cf817ba14645\r\nError Number:4060,State:1,Class:11","Category":"Error","Name":"Unhandled Exception","EventType":"Error","Id":3000,"Message":"Cannot open database \"IdentityServer4.Combined-2.3.0\" requested by the login. The login failed.\r\nLogin failed for user 'MYZFC\\zfc'.","ActivityId":"0HLP3M4G4EE5G:00000001","TimeStamp":"2019-08-18T07:53:27.0000000Z","ProcessId":108956,"LocalIpAddress":"::1:5000","RemoteIpAddress":"::1","$type":"UnhandledExceptionEvent"}
2019-08-18 15:53:27.702 +08:00 [FTL] Unhandled exception: Cannot open database "IdentityServer4.Combined-2.3.0" requested by the login. The login failed.
Login failed for user 'MYZFC\zfc'.
System.Data.SqlClient.SqlException (0x80131904): Cannot open database "IdentityServer4.Combined-2.3.0" requested by the login. The login failed.
Login failed for user 'MYZFC\zfc'.
   at System.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, SqlCredential credential, Object providerInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString userConnectionOptions, SessionData reconnectSessionData, Boolean applyTransientFaultHandling)
   at System.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, DbConnectionPoolKey poolKey, Object poolGroupProviderInfo, DbConnectionPool pool, DbConnection owningConnection, DbConnectionOptions userOptions)
   at System.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(DbConnectionPool pool, DbConnection owningObject, DbConnectionOptions options, DbConnectionPoolKey poolKey, DbConnectionOptions userOptions)
   at System.Data.ProviderBase.DbConnectionPool.CreateObject(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at System.Data.ProviderBase.DbConnectionPool.UserCreateRequest(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at System.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, UInt32 waitForMultipleObjectsTimeout, Boolean allowCreate, Boolean onlyOneCheckConnection, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at System.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at System.Data.ProviderBase.DbConnectionFactory.TryGetConnection(DbConnection owningConnection, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal oldConnection, DbConnectionInternal& connection)
   at System.Data.ProviderBase.DbConnectionInternal.TryOpenConnectionInternal(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at System.Data.ProviderBase.DbConnectionClosed.TryOpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at System.Data.SqlClient.SqlConnection.TryOpen(TaskCompletionSource`1 retry)
   at System.Data.SqlClient.SqlConnection.Open()
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenDbConnection(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.Open(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryingEnumerable`1.Enumerator.BufferlessMoveNext(DbContext _, Boolean buffer)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryingEnumerable`1.Enumerator.MoveNext()
   at System.Linq.Enumerable.SelectEnumerableIterator`2.MoveNext()
   at Microsoft.EntityFrameworkCore.Query.Internal.LinqOperatorProvider._TrackEntities[TOut,TIn](IEnumerable`1 results, QueryContext queryContext, IList`1 entityTrackingInfos, IList`1 entityAccessors)+MoveNext()
   at Microsoft.EntityFrameworkCore.Query.Internal.LinqOperatorProvider.ExceptionInterceptor`1.EnumeratorExceptionInterceptor.MoveNext()
   at System.Collections.Generic.LargeArrayBuilder`1.AddRange(IEnumerable`1 items)
   at System.Collections.Generic.EnumerableHelpers.ToArray[T](IEnumerable`1 source)
   at System.Linq.Enumerable.ToArray[TSource](IEnumerable`1 source)
   at IdentityServer4.EntityFramework.Stores.ResourceStore.GetAllResourcesAsync() in C:\local\identity\server4\EntityFramework.Storage\src\Stores\ResourceStore.cs:line 138
   at IdentityServer4.Stores.IResourceStoreExtensions.GetAllEnabledResourcesAsync(IResourceStore store) in C:\local\identity\server4\IdentityServer4\src\Extensions\IResourceStoreExtensions.cs:line 105
   at IdentityServer4.ResponseHandling.DiscoveryResponseGenerator.CreateDiscoveryDocumentAsync(String baseUrl, String issuerUri) in C:\local\identity\server4\IdentityServer4\src\ResponseHandling\Default\DiscoveryResponseGenerator.cs:line 169
   at IdentityServer4.Endpoints.DiscoveryEndpoint.ProcessAsync(HttpContext context) in C:\local\identity\server4\IdentityServer4\src\Endpoints\DiscoveryEndpoint.cs:line 58
   at IdentityServer4.Hosting.IdentityServerMiddleware.Invoke(HttpContext context, IEndpointRouter router, IUserSession session, IEventService events) in C:\local\identity\server4\IdentityServer4\src\Hosting\IdentityServerMiddleware.cs:line 54
ClientConnectionId:c21b40b0-6daa-4d05-9282-cf817ba14645
Error Number:4060,State:1,Class:11
2019-08-18 15:57:34.572 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-18 15:57:34.578 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-18 15:57:34.579 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-18 15:57:34.588 +08:00 [DBG] Start discovery request
2019-08-18 15:57:34.801 +08:00 [DBG] Found [] as all scopes in database
2019-08-18 15:57:34.949 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-18 15:57:34.951 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-18 15:57:34.953 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-18 15:57:34.960 +08:00 [DBG] Start key discovery request
2019-08-18 15:57:35.063 +08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-08-18 15:57:35.074 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-08-18 15:57:35.111 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-08-18 15:57:35.125 +08:00 [DBG] Start authorize request
2019-08-18 15:57:35.145 +08:00 [DBG] No user present in authorize request
2019-08-18 15:57:35.150 +08:00 [DBG] Start authorize request protocol validation
2019-08-18 15:57:35.304 +08:00 [DBG] mvc found in database: false
2019-08-18 15:57:35.316 +08:00 [ERR] Unknown client or not enabled: mvc
{"ClientId":null,"ClientName":null,"RedirectUri":null,"AllowedRedirectUris":null,"SubjectId":"anonymous","ResponseType":null,"ResponseMode":null,"GrantType":null,"RequestedScopes":"","State":null,"UiLocales":null,"Nonce":null,"AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637017118550272152.ODZhOTk5MDktNWQ3Ni00ZTE3LTlmMzMtYzUxNGQyNGI5NzY5NzNmMzNiNTctOWNlMS00YTVmLWEzOGUtMzRjMTI5NDVjZjk2","state":"CfDJ8MjD-NDdxVVIn14o7d8uCcRVulTGJs-wrj27UtqJOrtz0sXHzGFUAaYOtH29VO0gACyV6mMahxI9dX7MZMRnWfu0xjjd7RhuLq841Fx61oFzcTDUO7L65yE5U9cwKi4fHEE4XaiP0rvO6FO9iafovNHai4AwwKCCs5Yn-LvVLRCAcbDDWY5kpguATxyRg185ejd4WsXFLG5HMcwZ0Y4nGFYBSY4ZKA3GGKc18zlhdAfdI1Ui0wf7zGzZk2nayx9_L5YCezRms3_RczupQani6fsZGhOOtEZFKXjcFWK_ozNc0QCztJ9pA3VHjdicaEOq55wibZ5mMVDrXh-LyAI-rGc","x-client-SKU":"ID_NETSTANDARD1_4","x-client-ver":"5.2.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-18 15:57:35.326 +08:00 [ERR] Request validation failed
2019-08-18 15:57:35.327 +08:00 [INF] {"ClientId":null,"ClientName":null,"RedirectUri":null,"AllowedRedirectUris":null,"SubjectId":"anonymous","ResponseType":null,"ResponseMode":null,"GrantType":null,"RequestedScopes":"","State":null,"UiLocales":null,"Nonce":null,"AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637017118550272152.ODZhOTk5MDktNWQ3Ni00ZTE3LTlmMzMtYzUxNGQyNGI5NzY5NzNmMzNiNTctOWNlMS00YTVmLWEzOGUtMzRjMTI5NDVjZjk2","state":"CfDJ8MjD-NDdxVVIn14o7d8uCcRVulTGJs-wrj27UtqJOrtz0sXHzGFUAaYOtH29VO0gACyV6mMahxI9dX7MZMRnWfu0xjjd7RhuLq841Fx61oFzcTDUO7L65yE5U9cwKi4fHEE4XaiP0rvO6FO9iafovNHai4AwwKCCs5Yn-LvVLRCAcbDDWY5kpguATxyRg185ejd4WsXFLG5HMcwZ0Y4nGFYBSY4ZKA3GGKc18zlhdAfdI1Ui0wf7zGzZk2nayx9_L5YCezRms3_RczupQani6fsZGhOOtEZFKXjcFWK_ozNc0QCztJ9pA3VHjdicaEOq55wibZ5mMVDrXh-LyAI-rGc","x-client-SKU":"ID_NETSTANDARD1_4","x-client-ver":"5.2.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-18 15:57:35.333 +08:00 [INF] {"ClientId":"mvc","ClientName":null,"RedirectUri":null,"Endpoint":"Authorize","SubjectId":null,"Scopes":"","GrantType":null,"Error":"unauthorized_client","ErrorDescription":"Unknown client or client not enabled","Category":"Token","Name":"Token Issued Failure","EventType":"Failure","Id":2001,"Message":null,"ActivityId":"0HLP3M4G4EE5I:00000001","TimeStamp":"2019-08-18T07:57:35.0000000Z","ProcessId":108956,"LocalIpAddress":"::1:5000","RemoteIpAddress":"::1","$type":"TokenIssuedFailureEvent"}
2019-08-18 16:07:13.307 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-18 16:07:13.311 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-18 16:07:13.312 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-18 16:07:13.313 +08:00 [DBG] Start discovery request
2019-08-18 16:07:13.881 +08:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2019-08-18 16:07:13.990 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-18 16:07:13.991 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-18 16:07:13.992 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-18 16:07:13.993 +08:00 [DBG] Start key discovery request
2019-08-18 16:07:14.079 +08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-08-18 16:07:14.081 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-08-18 16:07:14.082 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-08-18 16:07:14.083 +08:00 [DBG] Start authorize request
2019-08-18 16:07:14.084 +08:00 [DBG] No user present in authorize request
2019-08-18 16:07:14.085 +08:00 [DBG] Start authorize request protocol validation
2019-08-18 16:07:14.411 +08:00 [DBG] mvc found in database: true
2019-08-18 16:07:14.418 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-18 16:07:14.426 +08:00 [DBG] Checking for PKCE parameters
2019-08-18 16:07:14.429 +08:00 [DBG] No PKCE used.
2019-08-18 16:07:14.502 +08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-08-18 16:07:14.659 +08:00 [DBG] Found ["api1"] API scopes in database
2019-08-18 16:07:14.675 +08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-08-18 16:07:14.679 +08:00 [DBG] Found ["api1"] API scopes in database
2019-08-18 16:07:14.693 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-18 16:07:14.695 +08:00 [INF] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"anonymous","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 offline_access","State":"CfDJ8MjD-NDdxVVIn14o7d8uCcSekrU_OrwgG9RKjZdJ2SZnzZy9vB0PboaibfTLtxSZ2KbaE2XkkMH_FcN8iwcfsUUN6b2BpxuS-hBDVldpMKD0o_6w3jH-gGGh_H-NMTVFg4UiHLB9kFpGLrQvsyb5AC9WL24BwTQFL6UZQJhVPTsBTczlF8BYno3krFO98FLmQ1LEV8pm0g9_teEj0q5bx9pXjAR_kqt3IdQOOKd8MNtmbGRf5grQ5N10BCSEOZGMN41KOG6go_dN8-RITaTXmvoDT0sUcMU-3zHQoAAwEWVkDgBccosBpssnquwLcqwjckEtfNZcrCImhJWNoxr4nfA","UiLocales":null,"Nonce":"637017124340549341.Mzc5ZjM4Y2EtYmFiMi00YzYxLTk4YTctZDU5ZWFhNjZhNmU4ZjgwM2RhNTMtYzlhZi00NTM2LWEzMGMtNDliNzdiZjIxNzg3","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637017124340549341.Mzc5ZjM4Y2EtYmFiMi00YzYxLTk4YTctZDU5ZWFhNjZhNmU4ZjgwM2RhNTMtYzlhZi00NTM2LWEzMGMtNDliNzdiZjIxNzg3","state":"CfDJ8MjD-NDdxVVIn14o7d8uCcSekrU_OrwgG9RKjZdJ2SZnzZy9vB0PboaibfTLtxSZ2KbaE2XkkMH_FcN8iwcfsUUN6b2BpxuS-hBDVldpMKD0o_6w3jH-gGGh_H-NMTVFg4UiHLB9kFpGLrQvsyb5AC9WL24BwTQFL6UZQJhVPTsBTczlF8BYno3krFO98FLmQ1LEV8pm0g9_teEj0q5bx9pXjAR_kqt3IdQOOKd8MNtmbGRf5grQ5N10BCSEOZGMN41KOG6go_dN8-RITaTXmvoDT0sUcMU-3zHQoAAwEWVkDgBccosBpssnquwLcqwjckEtfNZcrCImhJWNoxr4nfA","x-client-SKU":"ID_NETSTANDARD1_4","x-client-ver":"5.2.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-18 16:07:14.709 +08:00 [INF] Showing login: User is not authenticated
2019-08-18 16:07:14.748 +08:00 [DBG] Start authorize request protocol validation
2019-08-18 16:07:14.752 +08:00 [DBG] mvc found in database: true
2019-08-18 16:07:14.752 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-18 16:07:14.753 +08:00 [DBG] Checking for PKCE parameters
2019-08-18 16:07:14.754 +08:00 [DBG] No PKCE used.
2019-08-18 16:07:14.756 +08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-08-18 16:07:14.760 +08:00 [DBG] Found ["api1"] API scopes in database
2019-08-18 16:07:14.765 +08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-08-18 16:07:14.770 +08:00 [DBG] Found ["api1"] API scopes in database
2019-08-18 16:07:14.771 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-18 16:07:14.782 +08:00 [DBG] mvc found in database: true
2019-08-18 16:07:14.782 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-18 16:07:31.207 +08:00 [DBG] CORS request made for path: /Account/Login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-18 16:07:31.268 +08:00 [DBG] Start authorize request protocol validation
2019-08-18 16:07:31.278 +08:00 [DBG] mvc found in database: true
2019-08-18 16:07:31.278 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-18 16:07:31.280 +08:00 [DBG] Checking for PKCE parameters
2019-08-18 16:07:31.280 +08:00 [DBG] No PKCE used.
2019-08-18 16:07:31.283 +08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-08-18 16:07:31.290 +08:00 [DBG] Found ["api1"] API scopes in database
2019-08-18 16:07:31.293 +08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-08-18 16:07:31.298 +08:00 [DBG] Found ["api1"] API scopes in database
2019-08-18 16:07:31.299 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-18 16:07:31.545 +08:00 [DBG] Augmenting SignInContext
2019-08-18 16:07:31.548 +08:00 [DBG] Adding idp claim with value: local
2019-08-18 16:07:31.548 +08:00 [DBG] Adding amr claim with value: pwd
2019-08-18 16:07:31.549 +08:00 [DBG] Adding auth_time claim with value: 1566115651
2019-08-18 16:07:31.564 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-08-18 16:07:31.570 +08:00 [INF] {"Username":"alice","Provider":null,"ProviderUserId":null,"SubjectId":"f0bc2a0b-1b12-4058-b401-c055f31581f7","DisplayName":"alice","Endpoint":"UI","Category":"Authentication","Name":"User Login Success","EventType":"Success","Id":1000,"Message":null,"ActivityId":"0HLP3M4G4EE5Q:00000002","TimeStamp":"2019-08-18T08:07:31.0000000Z","ProcessId":108956,"LocalIpAddress":"::1:5000","RemoteIpAddress":"::1","$type":"UserLoginSuccessEvent"}
2019-08-18 16:07:31.578 +08:00 [DBG] mvc found in database: true
2019-08-18 16:07:31.578 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-18 16:07:31.607 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-18 16:07:31.608 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-18 16:07:31.609 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-18 16:07:31.615 +08:00 [DBG] Start authorize callback request
2019-08-18 16:07:31.623 +08:00 [DBG] User in authorize request: f0bc2a0b-1b12-4058-b401-c055f31581f7
2019-08-18 16:07:31.623 +08:00 [DBG] Start authorize request protocol validation
2019-08-18 16:07:31.627 +08:00 [DBG] mvc found in database: true
2019-08-18 16:07:31.627 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-18 16:07:31.628 +08:00 [DBG] Checking for PKCE parameters
2019-08-18 16:07:31.628 +08:00 [DBG] No PKCE used.
2019-08-18 16:07:31.632 +08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-08-18 16:07:31.636 +08:00 [DBG] Found ["api1"] API scopes in database
2019-08-18 16:07:31.640 +08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-08-18 16:07:31.652 +08:00 [DBG] Found ["api1"] API scopes in database
2019-08-18 16:07:31.653 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-18 16:07:31.653 +08:00 [INF] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"f0bc2a0b-1b12-4058-b401-c055f31581f7","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 offline_access","State":"CfDJ8MjD-NDdxVVIn14o7d8uCcSekrU_OrwgG9RKjZdJ2SZnzZy9vB0PboaibfTLtxSZ2KbaE2XkkMH_FcN8iwcfsUUN6b2BpxuS-hBDVldpMKD0o_6w3jH-gGGh_H-NMTVFg4UiHLB9kFpGLrQvsyb5AC9WL24BwTQFL6UZQJhVPTsBTczlF8BYno3krFO98FLmQ1LEV8pm0g9_teEj0q5bx9pXjAR_kqt3IdQOOKd8MNtmbGRf5grQ5N10BCSEOZGMN41KOG6go_dN8-RITaTXmvoDT0sUcMU-3zHQoAAwEWVkDgBccosBpssnquwLcqwjckEtfNZcrCImhJWNoxr4nfA","UiLocales":null,"Nonce":"637017124340549341.Mzc5ZjM4Y2EtYmFiMi00YzYxLTk4YTctZDU5ZWFhNjZhNmU4ZjgwM2RhNTMtYzlhZi00NTM2LWEzMGMtNDliNzdiZjIxNzg3","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"a075ce2b32d56094ef55afa8ecce0505","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637017124340549341.Mzc5ZjM4Y2EtYmFiMi00YzYxLTk4YTctZDU5ZWFhNjZhNmU4ZjgwM2RhNTMtYzlhZi00NTM2LWEzMGMtNDliNzdiZjIxNzg3","state":"CfDJ8MjD-NDdxVVIn14o7d8uCcSekrU_OrwgG9RKjZdJ2SZnzZy9vB0PboaibfTLtxSZ2KbaE2XkkMH_FcN8iwcfsUUN6b2BpxuS-hBDVldpMKD0o_6w3jH-gGGh_H-NMTVFg4UiHLB9kFpGLrQvsyb5AC9WL24BwTQFL6UZQJhVPTsBTczlF8BYno3krFO98FLmQ1LEV8pm0g9_teEj0q5bx9pXjAR_kqt3IdQOOKd8MNtmbGRf5grQ5N10BCSEOZGMN41KOG6go_dN8-RITaTXmvoDT0sUcMU-3zHQoAAwEWVkDgBccosBpssnquwLcqwjckEtfNZcrCImhJWNoxr4nfA","x-client-SKU":"ID_NETSTANDARD1_4","x-client-ver":"5.2.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-18 16:07:31.701 +08:00 [DBG] Scopes contains offline_access, consent is required
2019-08-18 16:07:31.702 +08:00 [INF] Showing consent: User has not yet consented
2019-08-18 16:07:31.751 +08:00 [DBG] Start authorize request protocol validation
2019-08-18 16:07:31.756 +08:00 [DBG] mvc found in database: true
2019-08-18 16:07:31.756 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-18 16:07:31.758 +08:00 [DBG] Checking for PKCE parameters
2019-08-18 16:07:31.758 +08:00 [DBG] No PKCE used.
2019-08-18 16:07:31.761 +08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-08-18 16:07:31.766 +08:00 [DBG] Found ["api1"] API scopes in database
2019-08-18 16:07:31.770 +08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-08-18 16:07:31.774 +08:00 [DBG] Found ["api1"] API scopes in database
2019-08-18 16:07:31.775 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-18 16:07:31.780 +08:00 [DBG] mvc found in database: true
2019-08-18 16:07:31.781 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-18 16:07:31.791 +08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-08-18 16:07:31.892 +08:00 [DBG] Found ["api1"] API scopes in database
2019-08-18 16:07:41.287 +08:00 [DBG] CORS request made for path: /consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-18 16:07:41.323 +08:00 [DBG] Start authorize request protocol validation
2019-08-18 16:07:41.329 +08:00 [DBG] mvc found in database: true
2019-08-18 16:07:41.331 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-18 16:07:41.332 +08:00 [DBG] Checking for PKCE parameters
2019-08-18 16:07:41.333 +08:00 [DBG] No PKCE used.
2019-08-18 16:07:41.343 +08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-08-18 16:07:41.352 +08:00 [DBG] Found ["api1"] API scopes in database
2019-08-18 16:07:41.358 +08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-08-18 16:07:41.363 +08:00 [DBG] Found ["api1"] API scopes in database
2019-08-18 16:07:41.363 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-18 16:07:41.366 +08:00 [INF] {"SubjectId":"f0bc2a0b-1b12-4058-b401-c055f31581f7","ClientId":"mvc","RequestedScopes":["openid","profile","api1","offline_access"],"GrantedScopes":["openid","profile","api1","offline_access"],"ConsentRemembered":false,"Category":"Grants","Name":"Consent granted","EventType":"Information","Id":4000,"Message":null,"ActivityId":"0HLP3M4G4EE5P:00000004","TimeStamp":"2019-08-18T08:07:41.0000000Z","ProcessId":108956,"LocalIpAddress":"::1:5000","RemoteIpAddress":"::1","$type":"ConsentGrantedEvent"}
2019-08-18 16:07:41.389 +08:00 [DBG] mvc found in database: true
2019-08-18 16:07:41.390 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-18 16:07:41.412 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-18 16:07:41.413 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-18 16:07:41.413 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-18 16:07:41.415 +08:00 [DBG] Start authorize callback request
2019-08-18 16:07:41.418 +08:00 [DBG] User in authorize request: f0bc2a0b-1b12-4058-b401-c055f31581f7
2019-08-18 16:07:41.419 +08:00 [DBG] Start authorize request protocol validation
2019-08-18 16:07:41.429 +08:00 [DBG] mvc found in database: true
2019-08-18 16:07:41.429 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-18 16:07:41.430 +08:00 [DBG] Checking for PKCE parameters
2019-08-18 16:07:41.431 +08:00 [DBG] No PKCE used.
2019-08-18 16:07:41.434 +08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-08-18 16:07:41.442 +08:00 [DBG] Found ["api1"] API scopes in database
2019-08-18 16:07:41.445 +08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-08-18 16:07:41.453 +08:00 [DBG] Found ["api1"] API scopes in database
2019-08-18 16:07:41.454 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-18 16:07:41.455 +08:00 [INF] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"f0bc2a0b-1b12-4058-b401-c055f31581f7","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 offline_access","State":"CfDJ8MjD-NDdxVVIn14o7d8uCcSekrU_OrwgG9RKjZdJ2SZnzZy9vB0PboaibfTLtxSZ2KbaE2XkkMH_FcN8iwcfsUUN6b2BpxuS-hBDVldpMKD0o_6w3jH-gGGh_H-NMTVFg4UiHLB9kFpGLrQvsyb5AC9WL24BwTQFL6UZQJhVPTsBTczlF8BYno3krFO98FLmQ1LEV8pm0g9_teEj0q5bx9pXjAR_kqt3IdQOOKd8MNtmbGRf5grQ5N10BCSEOZGMN41KOG6go_dN8-RITaTXmvoDT0sUcMU-3zHQoAAwEWVkDgBccosBpssnquwLcqwjckEtfNZcrCImhJWNoxr4nfA","UiLocales":null,"Nonce":"637017124340549341.Mzc5ZjM4Y2EtYmFiMi00YzYxLTk4YTctZDU5ZWFhNjZhNmU4ZjgwM2RhNTMtYzlhZi00NTM2LWEzMGMtNDliNzdiZjIxNzg3","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"a075ce2b32d56094ef55afa8ecce0505","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637017124340549341.Mzc5ZjM4Y2EtYmFiMi00YzYxLTk4YTctZDU5ZWFhNjZhNmU4ZjgwM2RhNTMtYzlhZi00NTM2LWEzMGMtNDliNzdiZjIxNzg3","state":"CfDJ8MjD-NDdxVVIn14o7d8uCcSekrU_OrwgG9RKjZdJ2SZnzZy9vB0PboaibfTLtxSZ2KbaE2XkkMH_FcN8iwcfsUUN6b2BpxuS-hBDVldpMKD0o_6w3jH-gGGh_H-NMTVFg4UiHLB9kFpGLrQvsyb5AC9WL24BwTQFL6UZQJhVPTsBTczlF8BYno3krFO98FLmQ1LEV8pm0g9_teEj0q5bx9pXjAR_kqt3IdQOOKd8MNtmbGRf5grQ5N10BCSEOZGMN41KOG6go_dN8-RITaTXmvoDT0sUcMU-3zHQoAAwEWVkDgBccosBpssnquwLcqwjckEtfNZcrCImhJWNoxr4nfA","x-client-SKU":"ID_NETSTANDARD1_4","x-client-ver":"5.2.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-18 16:07:41.464 +08:00 [DBG] Scopes contains offline_access, consent is required
2019-08-18 16:07:41.475 +08:00 [INF] User consented to scopes: ["openid","profile","api1","offline_access"]
2019-08-18 16:07:41.481 +08:00 [DBG] Client allows remembering consent, and no scopes provided. Removing consent from consent store for subject: f0bc2a0b-1b12-4058-b401-c055f31581f7
2019-08-18 16:07:41.534 +08:00 [DBG] no DilsjfTfZfFgFl0wVmxf7Sd3aqwL5896vr4x2W/Qpo4= persisted grant found in database
2019-08-18 16:07:41.548 +08:00 [DBG] Creating Hybrid Flow response.
2019-08-18 16:07:41.602 +08:00 [DBG] q0A8cFwDR6YrTJh14O5j6Y7R8gkOsIByk6w6yN8/M+E= not found in database
2019-08-18 16:07:41.671 +08:00 [DBG] Creating Implicit Flow response.
2019-08-18 16:07:41.683 +08:00 [DBG] Getting claims for identity token for subject: f0bc2a0b-1b12-4058-b401-c055f31581f7 and client: mvc
2019-08-18 16:07:41.688 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-08-18 16:07:41.762 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","Endpoint":"Authorize","SubjectId":"f0bc2a0b-1b12-4058-b401-c055f31581f7","Scopes":"openid profile api1 offline_access","GrantType":"hybrid","Tokens":[{"TokenType":"id_token","TokenValue":"****oK4w","$type":"Token"},{"TokenType":"code","TokenValue":"****e190","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLP3M4G4EE5P:00000005","TimeStamp":"2019-08-18T08:07:41.0000000Z","ProcessId":108956,"LocalIpAddress":"::1:5000","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-18 16:07:41.767 +08:00 [INF] Authorize endpoint response
{"SubjectId":"f0bc2a0b-1b12-4058-b401-c055f31581f7","ClientId":"mvc","RedirectUri":"http://localhost:5002/signin-oidc","State":"CfDJ8MjD-NDdxVVIn14o7d8uCcSekrU_OrwgG9RKjZdJ2SZnzZy9vB0PboaibfTLtxSZ2KbaE2XkkMH_FcN8iwcfsUUN6b2BpxuS-hBDVldpMKD0o_6w3jH-gGGh_H-NMTVFg4UiHLB9kFpGLrQvsyb5AC9WL24BwTQFL6UZQJhVPTsBTczlF8BYno3krFO98FLmQ1LEV8pm0g9_teEj0q5bx9pXjAR_kqt3IdQOOKd8MNtmbGRf5grQ5N10BCSEOZGMN41KOG6go_dN8-RITaTXmvoDT0sUcMU-3zHQoAAwEWVkDgBccosBpssnquwLcqwjckEtfNZcrCImhJWNoxr4nfA","Scope":"openid profile api1 offline_access","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2019-08-18 16:07:41.787 +08:00 [DBG] Augmenting SignInContext
2019-08-18 16:07:41.788 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-08-18 16:07:41.946 +08:00 [DBG] Request path /connect/token matched to endpoint type Token
2019-08-18 16:07:41.961 +08:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2019-08-18 16:07:41.964 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2019-08-18 16:07:41.984 +08:00 [DBG] Start token request.
2019-08-18 16:07:41.993 +08:00 [DBG] Start client validation
2019-08-18 16:07:42.001 +08:00 [DBG] Start parsing Basic Authentication secret
2019-08-18 16:07:42.008 +08:00 [DBG] Start parsing for secret in post body
2019-08-18 16:07:42.010 +08:00 [DBG] Parser found secret: PostBodySecretParser
2019-08-18 16:07:42.012 +08:00 [DBG] Secret id found: mvc
2019-08-18 16:07:42.019 +08:00 [DBG] mvc found in database: true
2019-08-18 16:07:42.019 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-18 16:07:42.036 +08:00 [DBG] Secret validator success: HashedSharedSecretValidator
2019-08-18 16:07:42.036 +08:00 [DBG] Client validation success
2019-08-18 16:07:42.037 +08:00 [INF] {"ClientId":"mvc","AuthenticationMethod":"SharedSecret","Category":"Authentication","Name":"Client Authentication Success","EventType":"Success","Id":1010,"Message":null,"ActivityId":"0HLP3M4G4EE5N:00000003","TimeStamp":"2019-08-18T08:07:42.0000000Z","ProcessId":108956,"LocalIpAddress":"::1:5000","RemoteIpAddress":"::1","$type":"ClientAuthenticationSuccessEvent"}
2019-08-18 16:07:42.045 +08:00 [DBG] Start token request validation
2019-08-18 16:07:42.060 +08:00 [DBG] Start validation of authorization code token request
2019-08-18 16:07:42.077 +08:00 [DBG] q0A8cFwDR6YrTJh14O5j6Y7R8gkOsIByk6w6yN8/M+E= found in database: true
2019-08-18 16:07:42.086 +08:00 [DBG] removing q0A8cFwDR6YrTJh14O5j6Y7R8gkOsIByk6w6yN8/M+E= persisted grant from database
2019-08-18 16:07:42.101 +08:00 [DBG] Validation of authorization code token request success
2019-08-18 16:07:42.108 +08:00 [INF] Token request validation success
{"ClientId":"mvc","ClientName":"MVC Client","GrantType":"authorization_code","Scopes":null,"AuthorizationCode":"f09b66cf3a86a8bdb6e284d08866bdefc17a9283701a905f3d7ae1e0465ae190","RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"client_id":"mvc","client_secret":"***REDACTED***","code":"f09b66cf3a86a8bdb6e284d08866bdefc17a9283701a905f3d7ae1e0465ae190","grant_type":"authorization_code","redirect_uri":"http://localhost:5002/signin-oidc"},"$type":"TokenRequestValidationLog"}
2019-08-18 16:07:42.139 +08:00 [DBG] mvc found in database: true
2019-08-18 16:07:42.139 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-18 16:07:42.142 +08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-08-18 16:07:42.145 +08:00 [DBG] Found ["api1"] API scopes in database
2019-08-18 16:07:42.159 +08:00 [DBG] Getting claims for access token for client: mvc
2019-08-18 16:07:42.160 +08:00 [DBG] Getting claims for access token for subject: f0bc2a0b-1b12-4058-b401-c055f31581f7
2019-08-18 16:07:42.199 +08:00 [DBG] Creating refresh token
2019-08-18 16:07:42.200 +08:00 [DBG] Setting an absolute lifetime: 2592000
2019-08-18 16:07:42.219 +08:00 [DBG] fkPreHQFuaZFGt+ig18VH64HA2EWAvSGmYcYeIRijdI= not found in database
2019-08-18 16:07:42.238 +08:00 [DBG] mvc found in database: true
2019-08-18 16:07:42.239 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-18 16:07:42.242 +08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-08-18 16:07:42.247 +08:00 [DBG] Found ["api1"] API scopes in database
2019-08-18 16:07:42.248 +08:00 [DBG] Getting claims for identity token for subject: f0bc2a0b-1b12-4058-b401-c055f31581f7 and client: mvc
2019-08-18 16:07:42.249 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-08-18 16:07:42.257 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":null,"Endpoint":"Token","SubjectId":null,"Scopes":"openid profile api1 offline_access","GrantType":"authorization_code","Tokens":[{"TokenType":"id_token","TokenValue":"****8QRQ","$type":"Token"},{"TokenType":"refresh_token","TokenValue":"****4281","$type":"Token"},{"TokenType":"access_token","TokenValue":"****0eAQ","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLP3M4G4EE5N:00000003","TimeStamp":"2019-08-18T08:07:42.0000000Z","ProcessId":108956,"LocalIpAddress":"::1:5000","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-18 16:07:42.265 +08:00 [DBG] Token request success.
2019-08-18 16:07:42.286 +08:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2019-08-18 16:07:42.292 +08:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2019-08-18 16:07:42.294 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2019-08-18 16:07:42.304 +08:00 [DBG] Start userinfo request
2019-08-18 16:07:42.308 +08:00 [DBG] Bearer token found in header
2019-08-18 16:07:42.376 +08:00 [DBG] mvc found in database: true
2019-08-18 16:07:42.376 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-18 16:07:42.383 +08:00 [DBG] mvc found in database: true
2019-08-18 16:07:42.385 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-18 16:07:42.393 +08:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2019-08-18 16:07:42.395 +08:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":null,"Claims":{"nbf":1566115662,"exp":1566119262,"iss":"http://localhost:5000","aud":["http://localhost:5000/resources","api1"],"client_id":"mvc","sub":"f0bc2a0b-1b12-4058-b401-c055f31581f7","auth_time":1566115651,"idp":"local","scope":["openid","profile","api1","offline_access"],"amr":"pwd"},"$type":"TokenValidationLog"}
2019-08-18 16:07:42.408 +08:00 [DBG] Creating userinfo response
2019-08-18 16:07:42.412 +08:00 [DBG] Scopes in access token: openid profile api1 offline_access
2019-08-18 16:07:42.416 +08:00 [DBG] Scopes in access token: openid profile api1 offline_access
2019-08-18 16:07:42.420 +08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-08-18 16:07:42.422 +08:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at
2019-08-18 16:07:42.422 +08:00 [DBG] Scopes in access token: openid profile api1 offline_access
2019-08-18 16:07:42.424 +08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-08-18 16:07:42.429 +08:00 [INF] Profile service returned the following claim types: sub name given_name family_name website preferred_username
2019-08-18 16:07:42.430 +08:00 [DBG] End userinfo request
2019-08-18 16:08:06.639 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-18 16:08:06.641 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-18 16:08:06.642 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-18 16:08:06.642 +08:00 [DBG] Start discovery request
2019-08-18 16:08:06.647 +08:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2019-08-18 16:08:06.728 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-18 16:08:06.729 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-18 16:08:06.729 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-18 16:08:06.730 +08:00 [DBG] Start key discovery request
2019-08-18 16:14:29.670 +08:00 [DBG] Request path /connect/endsession matched to endpoint type Endsession
2019-08-18 16:14:29.671 +08:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionEndpoint
2019-08-18 16:14:29.671 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionEndpoint for /connect/endsession
2019-08-18 16:14:29.678 +08:00 [DBG] Processing signout request for f0bc2a0b-1b12-4058-b401-c055f31581f7
2019-08-18 16:14:29.688 +08:00 [DBG] Start end session request validation
2019-08-18 16:14:29.699 +08:00 [DBG] Start identity token validation
2019-08-18 16:14:29.712 +08:00 [DBG] mvc found in database: true
2019-08-18 16:14:29.712 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-18 16:14:29.714 +08:00 [DBG] Client found: mvc / MVC Client
2019-08-18 16:14:29.727 +08:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2019-08-18 16:14:29.728 +08:00 [DBG] Token validation success
{"ClientId":"mvc","ClientName":"MVC Client","ValidateLifetime":false,"AccessTokenType":null,"ExpectedScope":null,"TokenHandle":null,"JwtId":null,"Claims":{"nbf":1566115662,"exp":1566115962,"iss":"http://localhost:5000","aud":"mvc","nonce":"637017124340549341.Mzc5ZjM4Y2EtYmFiMi00YzYxLTk4YTctZDU5ZWFhNjZhNmU4ZjgwM2RhNTMtYzlhZi00NTM2LWEzMGMtNDliNzdiZjIxNzg3","iat":1566115662,"at_hash":"akR3xUCgL6cuQe-xPLe60Q","sid":"a075ce2b32d56094ef55afa8ecce0505","sub":"f0bc2a0b-1b12-4058-b401-c055f31581f7","auth_time":1566115651,"idp":"local","amr":"pwd"},"$type":"TokenValidationLog"}
2019-08-18 16:14:29.736 +08:00 [INF] End session request validation success
{"ClientId":"mvc","ClientName":"MVC Client","SubjectId":"f0bc2a0b-1b12-4058-b401-c055f31581f7","PostLogOutUri":"http://localhost:5002/signout-callback-oidc","State":"CfDJ8MjD-NDdxVVIn14o7d8uCcSck4HZyLinRZ8NQZStDKbF0ZAMezBrpHnnr9BLB6rPAF_4fFE9XeSGGhVHRzEdRy6WmEC2pWG4ghgi5Z-zQzsKrzkzNM7zbtohnSlx7tAAmBKRn8VHh3T0i17zS2cf5AF5o6nM4zMRR-Y21-Wp0vXl","Raw":{"post_logout_redirect_uri":"http://localhost:5002/signout-callback-oidc","id_token_hint":"eyJhbGciOiJSUzI1NiIsImtpZCI6IjhhYTcxYWNmNDU1NjdkNWE1MjRmNWUxOWQ1MThiZjQxIiwidHlwIjoiSldUIn0.eyJuYmYiOjE1NjYxMTU2NjIsImV4cCI6MTU2NjExNTk2MiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo1MDAwIiwiYXVkIjoibXZjIiwibm9uY2UiOiI2MzcwMTcxMjQzNDA1NDkzNDEuTXpjNVpqTTRZMkV0WW1GaU1pMDBZell4TFRrNFlUY3RaRFU1WldGaE5qWmhObVU0Wmpnd00yUmhOVE10WXpsaFppMDBOVE0yTFdFek1HTXRORGxpTnpkaVpqSXhOemczIiwiaWF0IjoxNTY2MTE1NjYyLCJhdF9oYXNoIjoiYWtSM3hVQ2dMNmN1UWUteFBMZTYwUSIsInNpZCI6ImEwNzVjZTJiMzJkNTYwOTRlZjU1YWZhOGVjY2UwNTA1Iiwic3ViIjoiZjBiYzJhMGItMWIxMi00MDU4LWI0MDEtYzA1NWYzMTU4MWY3IiwiYXV0aF90aW1lIjoxNTY2MTE1NjUxLCJpZHAiOiJsb2NhbCIsImFtciI6WyJwd2QiXX0.CiefKPnZmZCMbmVKa-jGGu6f9TB_fU7N5m5BYbmy596IP4nW34S-5yF3x7-D-zp5DL1d97gSgVg2Vvp6N15SW2ui77xepsOscjsm6F83u77At8AoCsRykxx19HeE3IegIu4sVjtEq8j3z3XMiUbVX_kOMep_466v4VG0I-K_UqKdOgTt5pF677VjKA3J0MPjYQq9SW31tKuChpayZ6iABMZzve1ffQerov3lzHU-_6T3YAlqdWvCR85fUDJSWYe_4GVj7jWPjdELdnweaq2pW9hNRycJhDWFs_ntTIJqkxI5VOfcLxvgP--LO0T1BaTo60dyBIIv6k4cH_ix_T8QRQ","state":"CfDJ8MjD-NDdxVVIn14o7d8uCcSck4HZyLinRZ8NQZStDKbF0ZAMezBrpHnnr9BLB6rPAF_4fFE9XeSGGhVHRzEdRy6WmEC2pWG4ghgi5Z-zQzsKrzkzNM7zbtohnSlx7tAAmBKRn8VHh3T0i17zS2cf5AF5o6nM4zMRR-Y21-Wp0vXl","x-client-SKU":"ID_NETSTANDARD1_4","x-client-ver":"5.2.0.0"},"$type":"EndSessionRequestValidationLog"}
2019-08-18 16:14:29.742 +08:00 [DBG] Success validating end session request from mvc
2019-08-18 16:14:29.830 +08:00 [INF] AuthenticationScheme: Identity.Application signed out.
2019-08-18 16:14:29.835 +08:00 [INF] AuthenticationScheme: Identity.External signed out.
2019-08-18 16:14:29.839 +08:00 [INF] AuthenticationScheme: Identity.TwoFactorUserId signed out.
2019-08-18 16:14:29.843 +08:00 [INF] {"SubjectId":"f0bc2a0b-1b12-4058-b401-c055f31581f7","DisplayName":"Alice Smith","Category":"Authentication","Name":"User Logout Success","EventType":"Success","Id":1002,"Message":null,"ActivityId":"0HLP3M4G4EE5U:00000002","TimeStamp":"2019-08-18T08:14:29.0000000Z","ProcessId":108956,"LocalIpAddress":"::1:5000","RemoteIpAddress":"::1","$type":"UserLogoutSuccessEvent"}
2019-08-18 16:14:29.920 +08:00 [DBG] Request path /connect/endsession/callback matched to endpoint type Endsession
2019-08-18 16:14:29.973 +08:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionCallbackEndpoint
2019-08-18 16:14:29.981 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionCallbackEndpoint for /connect/endsession/callback
2019-08-18 16:14:30.008 +08:00 [DBG] Processing signout callback request
2019-08-18 16:14:30.045 +08:00 [DBG] mvc found in database: true
2019-08-18 16:14:30.046 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-18 16:14:30.046 +08:00 [DBG] No client front-channel logout URLs
2019-08-18 16:14:30.047 +08:00 [DBG] No client back-channel logout URLs
2019-08-18 16:14:30.047 +08:00 [INF] Successful signout callback.
2019-08-18 16:14:30.048 +08:00 [DBG] No client front-channel iframe urls
2019-08-18 16:14:30.048 +08:00 [DBG] No client back-channel iframe urls
2019-08-18 16:14:59.571 +08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-08-18 16:14:59.573 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-08-18 16:14:59.574 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-08-18 16:14:59.575 +08:00 [DBG] Start authorize request
2019-08-18 16:14:59.575 +08:00 [DBG] No user present in authorize request
2019-08-18 16:14:59.575 +08:00 [DBG] Start authorize request protocol validation
2019-08-18 16:14:59.582 +08:00 [DBG] mvc found in database: true
2019-08-18 16:14:59.583 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-18 16:14:59.583 +08:00 [DBG] Checking for PKCE parameters
2019-08-18 16:14:59.584 +08:00 [DBG] No PKCE used.
2019-08-18 16:14:59.586 +08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-08-18 16:14:59.591 +08:00 [DBG] Found ["api1"] API scopes in database
2019-08-18 16:14:59.595 +08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-08-18 16:14:59.602 +08:00 [DBG] Found ["api1"] API scopes in database
2019-08-18 16:14:59.603 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-18 16:14:59.604 +08:00 [INF] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"anonymous","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 offline_access","State":"CfDJ8MjD-NDdxVVIn14o7d8uCcTPFvmPNGWOVwrIAM-Xu8gf47sKDoH01mN6KdFrdx2I6J4pMkzOIhzrolc1tdfwZqJ0-RLzCfghmHaeyd78e3jmCdWIkjMwzzgQ1S28lP-2hwpru-w-OUX_W8brzKCw8oGvFWo5yv9IwHuZLw8RicpOnGsYvYZtJRdCtxyOAjpyXUm3LOH-qrYS8JgWAFV8uXFVPh-GhF6yWT_MH9nouJJV7FLHcge0xU6F3YtmA64xuQAjNSbHTM2RrcydrziOe3j5DPKAsuSYAcqcr6CVNO9wi1d1fcoR7Bg5FEG5CTwzLp9yFYteDmuSYJ5uYnCj7P0","UiLocales":null,"Nonce":"637017128995573683.NjkyYjYwNDMtOTY5MC00NmQ0LWE5MmYtZGJiMTYzZTE4MDc5ZTZlYzdhZWUtMmJmZS00NDljLWFjOWQtMzU0OWY5MDMxMTg2","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637017128995573683.NjkyYjYwNDMtOTY5MC00NmQ0LWE5MmYtZGJiMTYzZTE4MDc5ZTZlYzdhZWUtMmJmZS00NDljLWFjOWQtMzU0OWY5MDMxMTg2","state":"CfDJ8MjD-NDdxVVIn14o7d8uCcTPFvmPNGWOVwrIAM-Xu8gf47sKDoH01mN6KdFrdx2I6J4pMkzOIhzrolc1tdfwZqJ0-RLzCfghmHaeyd78e3jmCdWIkjMwzzgQ1S28lP-2hwpru-w-OUX_W8brzKCw8oGvFWo5yv9IwHuZLw8RicpOnGsYvYZtJRdCtxyOAjpyXUm3LOH-qrYS8JgWAFV8uXFVPh-GhF6yWT_MH9nouJJV7FLHcge0xU6F3YtmA64xuQAjNSbHTM2RrcydrziOe3j5DPKAsuSYAcqcr6CVNO9wi1d1fcoR7Bg5FEG5CTwzLp9yFYteDmuSYJ5uYnCj7P0","x-client-SKU":"ID_NETSTANDARD1_4","x-client-ver":"5.2.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-18 16:14:59.610 +08:00 [INF] Showing login: User is not authenticated
2019-08-18 16:14:59.616 +08:00 [DBG] Start authorize request protocol validation
2019-08-18 16:14:59.624 +08:00 [DBG] mvc found in database: true
2019-08-18 16:14:59.624 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-18 16:14:59.625 +08:00 [DBG] Checking for PKCE parameters
2019-08-18 16:14:59.626 +08:00 [DBG] No PKCE used.
2019-08-18 16:14:59.630 +08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-08-18 16:14:59.635 +08:00 [DBG] Found ["api1"] API scopes in database
2019-08-18 16:14:59.639 +08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-08-18 16:14:59.643 +08:00 [DBG] Found ["api1"] API scopes in database
2019-08-18 16:14:59.644 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-18 16:14:59.650 +08:00 [DBG] mvc found in database: true
2019-08-18 16:14:59.651 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-18 16:15:05.321 +08:00 [DBG] CORS request made for path: /Account/Login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-18 16:15:05.326 +08:00 [DBG] Start authorize request protocol validation
2019-08-18 16:15:05.338 +08:00 [DBG] mvc found in database: true
2019-08-18 16:15:05.339 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-18 16:15:05.340 +08:00 [DBG] Checking for PKCE parameters
2019-08-18 16:15:05.340 +08:00 [DBG] No PKCE used.
2019-08-18 16:15:05.343 +08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-08-18 16:15:05.349 +08:00 [DBG] Found ["api1"] API scopes in database
2019-08-18 16:15:05.352 +08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-08-18 16:15:05.357 +08:00 [DBG] Found ["api1"] API scopes in database
2019-08-18 16:15:05.358 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-18 16:15:05.367 +08:00 [DBG] mvc found in database: true
2019-08-18 16:15:05.368 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-18 16:15:05.372 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-18 16:15:05.374 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-18 16:15:05.374 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-18 16:15:05.375 +08:00 [DBG] Start authorize callback request
2019-08-18 16:15:05.376 +08:00 [DBG] No user present in authorize request
2019-08-18 16:15:05.376 +08:00 [DBG] Start authorize request protocol validation
2019-08-18 16:15:05.386 +08:00 [DBG] mvc found in database: true
2019-08-18 16:15:05.386 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-18 16:15:05.387 +08:00 [DBG] Checking for PKCE parameters
2019-08-18 16:15:05.387 +08:00 [DBG] No PKCE used.
2019-08-18 16:15:05.390 +08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-08-18 16:15:05.393 +08:00 [DBG] Found ["api1"] API scopes in database
2019-08-18 16:15:05.397 +08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-08-18 16:15:05.401 +08:00 [DBG] Found ["api1"] API scopes in database
2019-08-18 16:15:05.402 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-18 16:15:05.403 +08:00 [INF] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"anonymous","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 offline_access","State":"CfDJ8MjD-NDdxVVIn14o7d8uCcTPFvmPNGWOVwrIAM-Xu8gf47sKDoH01mN6KdFrdx2I6J4pMkzOIhzrolc1tdfwZqJ0-RLzCfghmHaeyd78e3jmCdWIkjMwzzgQ1S28lP-2hwpru-w-OUX_W8brzKCw8oGvFWo5yv9IwHuZLw8RicpOnGsYvYZtJRdCtxyOAjpyXUm3LOH-qrYS8JgWAFV8uXFVPh-GhF6yWT_MH9nouJJV7FLHcge0xU6F3YtmA64xuQAjNSbHTM2RrcydrziOe3j5DPKAsuSYAcqcr6CVNO9wi1d1fcoR7Bg5FEG5CTwzLp9yFYteDmuSYJ5uYnCj7P0","UiLocales":null,"Nonce":"637017128995573683.NjkyYjYwNDMtOTY5MC00NmQ0LWE5MmYtZGJiMTYzZTE4MDc5ZTZlYzdhZWUtMmJmZS00NDljLWFjOWQtMzU0OWY5MDMxMTg2","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637017128995573683.NjkyYjYwNDMtOTY5MC00NmQ0LWE5MmYtZGJiMTYzZTE4MDc5ZTZlYzdhZWUtMmJmZS00NDljLWFjOWQtMzU0OWY5MDMxMTg2","state":"CfDJ8MjD-NDdxVVIn14o7d8uCcTPFvmPNGWOVwrIAM-Xu8gf47sKDoH01mN6KdFrdx2I6J4pMkzOIhzrolc1tdfwZqJ0-RLzCfghmHaeyd78e3jmCdWIkjMwzzgQ1S28lP-2hwpru-w-OUX_W8brzKCw8oGvFWo5yv9IwHuZLw8RicpOnGsYvYZtJRdCtxyOAjpyXUm3LOH-qrYS8JgWAFV8uXFVPh-GhF6yWT_MH9nouJJV7FLHcge0xU6F3YtmA64xuQAjNSbHTM2RrcydrziOe3j5DPKAsuSYAcqcr6CVNO9wi1d1fcoR7Bg5FEG5CTwzLp9yFYteDmuSYJ5uYnCj7P0","x-client-SKU":"ID_NETSTANDARD1_4","x-client-ver":"5.2.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-18 16:15:05.409 +08:00 [INF] Error: User denied consent
2019-08-18 16:15:05.409 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"anonymous","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 offline_access","State":"CfDJ8MjD-NDdxVVIn14o7d8uCcTPFvmPNGWOVwrIAM-Xu8gf47sKDoH01mN6KdFrdx2I6J4pMkzOIhzrolc1tdfwZqJ0-RLzCfghmHaeyd78e3jmCdWIkjMwzzgQ1S28lP-2hwpru-w-OUX_W8brzKCw8oGvFWo5yv9IwHuZLw8RicpOnGsYvYZtJRdCtxyOAjpyXUm3LOH-qrYS8JgWAFV8uXFVPh-GhF6yWT_MH9nouJJV7FLHcge0xU6F3YtmA64xuQAjNSbHTM2RrcydrziOe3j5DPKAsuSYAcqcr6CVNO9wi1d1fcoR7Bg5FEG5CTwzLp9yFYteDmuSYJ5uYnCj7P0","UiLocales":null,"Nonce":"637017128995573683.NjkyYjYwNDMtOTY5MC00NmQ0LWE5MmYtZGJiMTYzZTE4MDc5ZTZlYzdhZWUtMmJmZS00NDljLWFjOWQtMzU0OWY5MDMxMTg2","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637017128995573683.NjkyYjYwNDMtOTY5MC00NmQ0LWE5MmYtZGJiMTYzZTE4MDc5ZTZlYzdhZWUtMmJmZS00NDljLWFjOWQtMzU0OWY5MDMxMTg2","state":"CfDJ8MjD-NDdxVVIn14o7d8uCcTPFvmPNGWOVwrIAM-Xu8gf47sKDoH01mN6KdFrdx2I6J4pMkzOIhzrolc1tdfwZqJ0-RLzCfghmHaeyd78e3jmCdWIkjMwzzgQ1S28lP-2hwpru-w-OUX_W8brzKCw8oGvFWo5yv9IwHuZLw8RicpOnGsYvYZtJRdCtxyOAjpyXUm3LOH-qrYS8JgWAFV8uXFVPh-GhF6yWT_MH9nouJJV7FLHcge0xU6F3YtmA64xuQAjNSbHTM2RrcydrziOe3j5DPKAsuSYAcqcr6CVNO9wi1d1fcoR7Bg5FEG5CTwzLp9yFYteDmuSYJ5uYnCj7P0","x-client-SKU":"ID_NETSTANDARD1_4","x-client-ver":"5.2.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-18 16:15:05.416 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","Endpoint":"Authorize","SubjectId":null,"Scopes":"openid profile api1 offline_access","GrantType":"hybrid","Error":"access_denied","ErrorDescription":null,"Category":"Token","Name":"Token Issued Failure","EventType":"Failure","Id":2001,"Message":null,"ActivityId":"0HLP3M4G4EE5U:00000006","TimeStamp":"2019-08-18T08:15:05.0000000Z","ProcessId":108956,"LocalIpAddress":"::1:5000","RemoteIpAddress":"::1","$type":"TokenIssuedFailureEvent"}
